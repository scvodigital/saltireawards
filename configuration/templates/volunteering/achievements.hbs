{{#*inline "badge" ~}}
<div class="saltire-badge align-centre{{#if disabled}} disabled{{/if}}">
  <img src="{{~>asset_url url=(concat 'images/badges/badge.png') ~}}" class="img-responsive" />
  <span class="badge-content type-{{type}}">
    <span class="hours-{{key}}">
      {{hours}}
    </span>
  </span>
</div>
{{/inline ~}}

{{#compare (length @root.data.tasksInfo) 0 ~}}
{{> log_empty}}
{{else}}
<div class="container">
  {{!-- <h1>
    My achievements
  </h1> --}}
  <ul class="step">
    {{#each @root.context.metaData.certificates ~}}
    <li class="step-item{{#compare @root.data.verifyHoursInfo.award hours}} active{{/compare}}">
      <a href="#" class="tooltip" data-tooltip="{{certificate_name}} hours">{{hours}}</a>
    </li>
    {{/each ~}}
  </ul>
  <div class="columns achievements">
    {{#each @root.context.metaData.certificates ~}}
    <div class="column col-4 t-margin-full">
      {{!-- It's already awarded --}}
      {{#compare (sumArray (pluck @root.data.tasksInfo "hours_verified")) ">=" hours ~}}
      {{> badge type=type key=@key hours=hours}}
      <div class="text-center description">
        <p>
          {{certificate_name}} hour certificate awarded!
        </p>
        <a href="/certificate" class="btn btn-primary" download>Download</a>
      </div>
      {{else}}
      {{#compare @root.data.verifyHoursInfo.award "===" hours ~}}
      {{!-- It's being verified --}}
      {{> badge type=type key=@key hours=hours}}
      <div class="text-center description">
        {{certificate_name}} hour award being verified. <a href="/verify-hours-email-send/?award={{hours}}">Resend verification message</a>
      </div>
      {{else}}
      {{!-- A bigger award is being verified --}}
      {{#compare @root.data.verifyHoursInfo.award ">" hours ~}}
      {{!-- It's being verified --}}
      {{> badge type=type key=@key hours=hours}}
      <div class="text-center description">
        Larger award being verified.
      </div>
      {{else}}

      {{#compare (sumArray (pluck @root.data.tasksInfo "hours")) ">=" hours ~}}
      {{!-- It's ready to claim--}}
      {{> badge type=type key=@key hours=hours}}
      <div class="text-center description">
        {{certificate_name}} hour certificate available!
        <a href="/verify-hours-email-send/?award={{hours}}">Claim this certificate</a>
      </div>
      {{else}}
      {{!-- It's not there yet --}}
      {{> badge type=type key=@key hours=hours disabled=true}}
      <div class="text-center description">
        {{subtract hours (sumArray (pluck @root.data.tasksInfo "hours"))}} {{inflect (subtract hours (sumArray (pluck @root.data.tasksInfo "hours"))) "hour" "hours"}} to go
      </div>
      {{/compare ~}}
      {{/compare ~}}
      {{/compare ~}}
      {{/compare ~}}
    </div>
    {{/each ~}}
  </div>
</div>
{{/compare ~}}
