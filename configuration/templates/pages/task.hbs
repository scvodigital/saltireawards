<div class="container b-padding-full v-margin-full">
  <h1>
    Add a task
  </h1>

  {{#withExtend this admin=(compare @root.data.accountInfo.user_type 'Group Admin') ~}}
  <h2>
    Task details
  </h2>

  <form id="task-details-form" action="/submit-task-details" method="POST" data-ajax-form='{
    "successCallback": "completeTaskWrite",
    "failureCallback": "completeTaskWrite"
  }'>
    <div class="form-horizontal">
      <div class="form-group">
        <div class="col-2">
          <label for="organisation_name" class="form-label">
            {{#if admin ~}}
            Organisation your group has volunteered with
            {{else}}
            Organisation you volunteer for
            {{/if ~}}
          </label>
        </div>
        <div class="col-5">
          <input id="organisation_name" name="organisation_name" class="form-input" placeholder="" value="{{@root.data.taskInfo.organisation_name}}" {{>form_validation_attributes @root.context.metaData.taskInfoValidation.organisation_name}}>
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="location" class="form-label">
            Location
          </label>
        </div>
        <div class="col-5">
          <input required id="location" name="location" class="form-input" placeholder="" value="{{@root.data.taskInfo.location}}" {{>form_validation_attributes @root.context.metaData.taskInfoValidation.location}}>
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="organisation_charity_number" class="form-label">
            Organisation Scottish Charity Number (optional, e.g. SC012345)
          </label>
        </div>
        <div class="col-2">
          <input autocomplete="off" id="organisation_charity_number" placeholder="" name="organisation_charity_number" class="form-input" value="{{@root.data.taskInfo.organisation_charity_number}}" {{>form_validation_attributes @root.context.metaData.taskInfoValidation.organisation_charity_number}}>
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="task_description" class="form-label">Volunteering description (optional)</label>
        </div>
        <div class="col-5">
          <textarea rows="4" cols="40" id="task_description" name="task_description" class="form-input" value="{{@root.data.taskInfo.task_description}}" {{>form_validation_attributes @root.context.metaData.taskInfoValidation.task_description}}></textarea>
        </div>
      </div>
    </div>

    <h2>
      Details of the person who manages this volunteering task
    </h2>

    <div class="form-horizontal">
      <div class="form-group">
        <div class="col-2">
          <label for="volunteer_manager_first_name" class="form-label">
            First name
          </label>
        </div>
        <div class="col-5">
          <input required id="volunteer_manager_first_name" name="volunteer_manager_first_name" placeholder=""
            {{>form_validation_attributes @root.context.metaData.taskInfoValidation.volunteer_manager_first_name}} class="form-input"
            {{#if admin ~}}
            value="{{default @root.data.taskInfo.volunteer_manager_first_name @root.data.accountInfo.first_name}}"
            {{else}}
            value="{{@root.data.taskInfo.volunteer_manager_first_name}}"
            {{/if ~}}
          >
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="volunteer_manager_last_name" class="form-label">
            Last name
          </label>
        </div>
        <div class="col-5">
          <input required id="volunteer_manager_last_name" name="volunteer_manager_last_name" placeholder=""
            {{>form_validation_attributes @root.context.metaData.taskInfoValidation.volunteer_manager_last_name}} class="form-input"
            {{#if admin ~}}
            value="{{default @root.data.taskInfo.volunteer_manager_last_name @root.data.accountInfo.last_name}}"
            {{else}}
            value="{{@root.data.taskInfo.volunteer_manager_last_name}}"
            {{/if ~}}
          >
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="volunteer_manager_title" class="form-label">
            Job title
          </label>
        </div>
        <div class="col-5">
          <input required id="volunteer_manager_title" name="volunteer_manager_title" placeholder=""
            {{>form_validation_attributes @root.context.metaData.taskInfoValidation.volunteer_manager_title}} class="form-input"
            {{#if admin ~}}
            value="{{default @root.data.taskInfo.volunteer_manager_title @root.data.accountInfo.title}}"
            {{else}}
            value="{{@root.data.taskInfo.volunteer_manager_title}}"
            {{/if ~}}
          >
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="volunteer_manager_email" class="form-label">
            Email address
          </label>
        </div>
        <div class="col-5">
          <input id="volunteer_manager_email" name="volunteer_manager_email" placeholder=""
            {{>form_validation_attributes @root.context.metaData.taskInfoValidation.volunteer_manager_email}} class="form-input"
            {{#if admin ~}}
            value="{{default @root.data.taskInfo.volunteer_manager_email @root.data.accountInfo.email}}"
            {{else}}
            value="{{@root.data.taskInfo.volunteer_manager_email}}"
            {{/if ~}}>
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="volunteer_manager_phone" class="form-label">
            Phone number (optional)
          </label>
        </div>
        <div class="col-5">
          <input id="volunteer_manager_phone" name="volunteer_manager_phone" placeholder=""
            {{>form_validation_attributes @root.context.metaData.taskInfoValidation.volunteer_manager_phone}} class="form-input"
            {{#if admin ~}}
            value="{{default @root.data.taskInfo.volunteer_manager_phone @root.data.accountInfo.phone}}"
            {{else}}
            value="{{@root.data.taskInfo.volunteer_manager_phone}}"
            {{/if ~}}
            >
        </div>
      </div>
      <div class="form-group">
        <div class="col-2">
          <label for="sdg" class="form-label">
            Which UN Sustainable Development Goal does this task match?
          </label>
        </div>
        <div class="col-5">
          <select class="form-select" id="sdg" name="sdg">
            <option value="" selected></option>
            {{#each @root.context.metaData.globalGoals ~}}
            <option value="{{@key}}">{{@key}}: {{title}}</option>
            {{/each ~}}
          </select>
        </div>
      </div>
    </div>
    {{!-- This will probably have a captcha in it, hence the separation, and weird submit format --}}
    <button id="detail-submit" type="submit" class="btn btn-primary b-margin-full" id="register-interest-submit" >
      Submit details
    </button>
  </form>
  {{/withExtend ~}}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    $('#task-details-form').on('submit', function(e){
      $('#task-details-form').find('.submit-button').prop('disabled', true);
    })

  });
  function completeTaskWrite(response){
    var jsonData = JSON.parse(response);
    if (jsonData.id){
      window.location.href = '/hours/';
    } else {
      $('.submit-button').prop('disabled', false);
      saltireawards.componentsInitialiser.snackbar.show({message:"Failed create task."});
    }
  }


</script>
{{!--
--}}
{{!-- <script src="https://www.google.com/recaptcha/api.js" async defer></script> --}}
